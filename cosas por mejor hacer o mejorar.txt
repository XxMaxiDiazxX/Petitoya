
------------------------- FALTANTE EN LO QUE SABEMOS XD --------------------------------

# Realizar un atributo para la tabla productos, que almacene el numero de compras, de cada producto, con el fin del implementar
un tipo rating de las comidas mas compradas y tambien lo que menos compren, para implementarlo en el inicio, con el fin de 
sugerir esas comidas que se estan perdiendo.

# Realizar apartado de estados de los pedidos, los activos y los inactivos

# Modificar el diccionario de datos

# realizar el feellback
de la pagina de error


# validar la actualizacion de el usuario, y que el admin solo ponga cuando en la creacion de ese usuario, que no se pueda cambiar el estado

# eliminar el boton de "Realzar pedido", para que solo aparesca si se realiza el click en el mismo cuadro

# FALTA MOSTRAR LOS PRODUCTOS POR ESTADISTICA PERO SE NECESITA MODIFICAR LA BASE DE DATOS

# realizar que solo aparesca la validacion del codigo de cambio de contraseña, cuando sea valido ya aparesca la creacion de la nueva contraseña
ademas de tambien darle diseño

# hacer el icono de carrito en la barra

#AJUSTAR BIEN EL FRONENT PAR QUE SE VEA BIEN

# realiazr que el administrado registe los superusuario( empleados) 


------------------- CAMBIOS JOHANSHITO --------------------------------

creacion de procedures
creacion de un trigger para generar un informe del monto del pedido automaticamente
modifcacion de las apis para uso de los procedures
modificacion del archivo del authContext por la creacion de la tabla de roles como foranea de la tabla de clientes
la libreria de envio del correo para recuperacion de contraseñas es nodemailer
cree la carpeta Usuarios en cliente que va a reunir todos los componenetes que van realacionados a la gestion de usuarios
instale una nueva libreria llamada crypto que me genera codigo para usar en el cambio de contraseña
JUEMADRE aver, cree una nueva cuenta de correo ya para petitoya para enviar correo para la recuperadcion de contraseña
cree 2 paginas nuevas una para validacion del codigo que envie para cambiar la contraseña, y para enviar el correo
el correo es petitoyaservice@gmail.com constraseña: asesinoZ@, se creo una contraseña de aplicacion y se implemento en la utilidad de email.Service.js del node
realice el sistema de pedidos y carrito (falta el fronent)



---------------------- CAMBIOS SUARIÑO ------------------------


cambio de contraseña ya encripta la contraseña nueva

DELIMITER //

CREATE PROCEDURE RealizarPedidoDesdeCarrito(
    IN p_id_cliente VARCHAR(20),
    OUT p_id_pedido INT,
    OUT p_message VARCHAR(255)
)
BEGIN
    DECLARE v_count INT;

    -- Verificar si hay elementos en el carrito para el cliente dado
    SELECT COUNT(*) INTO v_count
    FROM carrito
    WHERE id_cliente = p_id_cliente;

    IF v_count = 0 THEN
        SET p_message = 'El carrito está vacío';
    ELSE
        -- Crear un nuevo pedido
        INSERT INTO pedidos (id_cliente, estado, fecha_compra)
        VALUES (p_id_cliente, 'pendiente', NOW());

        SET p_id_pedido = LAST_INSERT_ID();

        -- Insertar productos del carrito en pedido_producto
        INSERT INTO pedido_producto (id_pedido, id_producto, precio_compra, cantidad)
        SELECT
            p_id_pedido,
            c.id_producto,
            p.precio,
            c.cantidad
        FROM carrito c
        JOIN productos p ON c.id_producto = p.id_producto
        WHERE c.id_cliente = p_id_cliente;

        -- Vaciar el carrito
        DELETE FROM carrito WHERE id_cliente = p_id_cliente;

        SET p_message = 'Pedido realizado con éxito';
    END IF;
END //

DELIMITER ;